<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.16"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Face Recognition: facenet_cpp_tensorflow</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Face Recognition
   </div>
   <div id="projectbrief">Google Facenet implementation in C++ for live face recognition</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.16 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">facenet_cpp_tensorflow </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Fully working live face recognition using retrained <a href="https://arxiv.org/abs/1503.03832">Google FaceNet</a> architecture. Implementation based on <a href="https://github.com/davidsandberg/facenet">David Sandberg's python implementation</a> and <a href="https://github.com/mndar/facenet_classifier">mndar's cpp implementation</a>. This neural network architecture was originally trained with a triplet loss function. Reimplementations have had trouble reproducing the original results of the paper with the triplet loss function. Reimplementations use Softmax loss instead with good results. David Sandberg states &gt;99.6% accuracy with a model trained on VGGFace2. Check <a href="https://github.com/davidsandberg/facenet/wiki">Github Wiki</a> for more info.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Dependencies</h1>
<p>cuda 10.0 + cudnn 7.5 <br  />
 bazel 0.18 <br  />
 protobuf 3.6.0 <br  />
 eigen 3.3.5 <br  />
 tensorflow r1.10+ <br  />
 opencv 3.4.3</p>
<h1><a class="anchor" id="autotoc_md2"></a>
Install dependencies</h1>
<p>You can use <a href="https://medium.com/@fanzongshaoxing/use-tensorflow-c-api-with-opencv3-bacb83ca5683">this Medium article</a> as a rough guideline for the tensorflow installation. See dependencies for more information on the versions used for this project.</p>
<ul>
<li>Install bazel 0.18, protobuf 3.6.0, eigen 3.3.5 <br  />
</li>
<li>tensorflow (1.10) <div class="fragment"><div class="line">sudo apt-get install python3-numpy python3-dev python3-pip python3-wheel</div>
<div class="line">sudo pip3 install six numpy wheel</div>
<div class="line">git clone https://github.com/tensorflow/tensorflow</div>
<div class="line">cd tensorflow</div>
<div class="line">git checkout r1.10      # or other release</div>
<div class="line"> </div>
<div class="line"># During configure: No to everything except cuda and jemalloc (for now)</div>
<div class="line">./configure</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"># build tensorflow c++ with bazel (you can change the number of cores used with jobs flag)</div>
<div class="line">bazel build -c opt --copt=-mavx --copt=-mavx2 --copt=-mfma --copt=-mfpmath=both \</div>
<div class="line">--copt=-msse4.2 --config=monolithic --config=cuda --jobs 4 //tensorflow:libtensorflow_cc.so</div>
<div class="line"># --config=monolithic is important, so tf works with opencv (for cv::imread)</div>
<div class="line"> </div>
<div class="line"># copy required files into a single path for c++ linkage</div>
<div class="line">sudo mkdir /usr/local/include/tf  # make a directory ubder /usr/local/include path</div>
<div class="line">sudo mkdir /usr/local/include/tf/tensorflow</div>
<div class="line">sudo cp -r bazel-genfiles/ /usr/local/include/tf</div>
<div class="line">sudo cp -r tensorflow/cc /usr/local/include/tf/tensorflow</div>
<div class="line">sudo cp -r tensorflow/core /usr/local/include/tf/tensorflow</div>
<div class="line">sudo cp -r third_party /usr/local/include/tf</div>
<div class="line">sudo cp bazel-bin/tensorflow/libtensorflow_cc.so /usr/local/lib</div>
<div class="line">sudo cp bazel-bin/tensorflow/libtensorflow_framework.so /usr/local/lib</div>
<div class="line"># OPTIONAL: also copy eigen to /usr/local/include/tf</div>
<div class="line">sudo cp -r /usr/local/include/eigen3 /usr/local/include/tf/third_party</div>
</div><!-- fragment --></li>
</ul>
<h1><a class="anchor" id="autotoc_md3"></a>
Download models</h1>
<ul>
<li><b>Download frozen tensorflow graph</b> from <a href="https://github.com/davidsandberg/facenet/#pre-trained-models">github.com/davidsandberg/facenet</a>. The links are in the pre-trained models section. This repo was tested with the VGGFace2 model. <b>After downloading move the .pb file to the models folder.</b></li>
<li>Download HaarCascadeClassifier to the empty models folder <div class="fragment"><div class="line">cd /path/to/facenet_cpp_tensorflow/models</div>
<div class="line">wget https://github.com/opencv/opencv/blob/master/data/haarcascades/haarcascade_frontalface_default.xml</div>
</div><!-- fragment --></li>
</ul>
<h1><a class="anchor" id="autotoc_md4"></a>
dlib</h1>
<ul>
<li>If dlib is <b>not</b> compiled on your machine, download dlib and then go ahead and compile this project. <div class="fragment"><div class="line"># go to folder one above this project and download dlib</div>
<div class="line">cd /path/to/facenet_cpp_tensorflow/..</div>
<div class="line">wget http://dlib.net/files/dlib-19.17.tar.bz2</div>
<div class="line">tar xfvj dlib-19.17.tar.bz2</div>
<div class="line">rm dlib-19.17.tar.bz2</div>
</div><!-- fragment --></li>
<li>If precompiled dlib library is used, please change the <a href="CMakeLists.txt">CMakeLists.txt</a>. Replace <b>add_subdirectory(path/to/dlib(-19.17)/ dlib_build)</b> with <b>find_package(dlib)</b>, then go ahead and compile this project</li>
</ul>
<h1><a class="anchor" id="autotoc_md5"></a>
Installation</h1>
<div class="fragment"><div class="line">mkdir build &amp;&amp; cd build</div>
<div class="line">cmake -D CMAKE_BUILD_TYPE=Release ..</div>
<div class="line">make -j${nproc}</div>
</div><!-- fragment --><p> Make sure to build this project as Release. If dlib is built in Debug, it is extremely slow at detecting faces ~0.01fps.</p>
<h1><a class="anchor" id="autotoc_md6"></a>
Usage</h1>
<p>Run this project with the path to your image directory of known people with class names as file names, e.g., class_name.jpg will be classified as class_name. Make sure you only have images in the imgs folder, no other files. <a class="el" href="_r_e_a_d_m_e_8md.html">README.md</a> will be skipped.</p>
<div class="fragment"><div class="line">./face_recognition ../imgs/</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md7"></a>
Stats</h1>
<p>Running with **~18fps** on Intel i7 7700HQ processor and NVIDIA GeForce GTX 1050 using OpenCV's HaarCascadeClassifier for face detection, with a few changes you can use dlibs face detection which is more accurate, but slower.</p>
<h1><a class="anchor" id="autotoc_md8"></a>
License</h1>
<p>Please respect all licenses of OpenCV, dlib, and the data the tensorflow model was trained on.</p>
<h1><a class="anchor" id="autotoc_md9"></a>
Info</h1>
<p>Niclas Wesemann <br  />
 <a href="#" onclick="location.href='mai'+'lto:'+'nic'+'la'+'s.w'+'es'+'ema'+'nn'+'@gm'+'ai'+'l.c'+'om'; return false;">niclas.wesemann@gmail.com</a> <br  />
 </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.16
</small></address>
</body>
</html>
